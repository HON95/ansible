# Setup sudo

- name: Disable password for sudo group
  when: 'linux_server_sudo_no_pass'
  lineinfile:
    path: '/etc/sudoers'
    backup: yes
    regexp: '^%sudo\s.+$'
    line: '%sudo ALL=(ALL:ALL) NOPASSWD: ALL'
    insertafter: '^%sudo\s.+$'
    validate: 'visudo -c %s'

- name: Disable password for ansible user
  when: 'linux_server_sudo_no_pass_ansible_user'
  lineinfile:
    path: '/etc/sudoers'
    backup: yes
    regexp: '^{{ linux_server_ansible_user}}\s.+$'
    line: '{{ linux_server_ansible_user }} ALL=(ALL:ALL) NOPASSWD: ALL'
    insertafter: '^%sudo\s.+$'
    validate: 'visudo -c %s'
