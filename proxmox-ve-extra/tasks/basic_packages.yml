# Setup packages

# TODO

# - name: Disable unattended upgrades
#   when: '"unattended-upgrades.service" in service_facts.ansible_facts.services'
#   systemd:
#     name: unattended-upgrades.service
#     state: stopped
#     enabled: no
#     masked: yes

# - name: Enable contrib and non-free archive areas
#   replace:
#     path: /etc/apt/sources.list
#     regexp: '^(deb|deb-src)\s+(\S+)\s+(\S+)\s+.*main.*'
#     replace: '\1 \2 \3 main contrib non-free'
#     backup: true
#   register: apt_enable_repo_areas

# - name: Update if changed repo areas
#   when: 'apt_enable_repo_areas.changed'
#   apt: update_cache=true

- name: Install basic packages
  apt:
    name:
      - python3
      - python3-pip
      - ca-certificates
      - software-properties-common
      - curl
      - vim
      - htop
      - screen
      - tree
      - bash-completion
      - rsync

- name: Install machine type-specific packages (physical)
  apt:
    name:
      # Don't install anything firmware-related on PVE, it may remove PVE stuff
      #- firmware-linux
      - smartmontools
      - lm-sensors
